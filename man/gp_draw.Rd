% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/posterior.R
\name{gp_draw}
\alias{gp_draw}
\title{One posterior draw of the intensity surface}
\usage{
gp_draw(state, tol = 1e-06)
}
\arguments{
\item{state}{A sampler state created by \code{gp_build_state()}, containing
at least \code{space_mat}, \code{time_mat}, \code{obs_idx}, \code{N},
\code{y_work}, \code{noise_var}, \code{kdiag_full}, \code{A_solve},
and \code{mu_infer}. The vector layout is sites Ã— times with time varying
fastest.}

\item{tol}{Convergence tolerance passed to the inner PCG solve.}
}
\value{
A numeric vector of length \code{state$N} containing one posterior
  draw of \eqn{\lambda} in the same ordering as \code{state$mu_infer}.
}
\description{
Generates a single posterior sample of \eqn{\lambda = \exp(z)} under the
Gaussian working model on the log scale with heteroscedastic variance
\eqn{D}. It draws a GP prior realisation \eqn{\eta \sim \mathcal N(0, K)},
adds working-likelihood noise \eqn{\varepsilon \sim \mathcal N(0, D)} on the
observed log scale, solves
\eqn{(S K S^\top + D)\alpha_{\sim} = (S\eta + \varepsilon) - y_{\text{work}}},
and returns \eqn{\exp(\eta - K S^\top \alpha_{\sim} + \mu_{\mathrm{infer}})}.
}
